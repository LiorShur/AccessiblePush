<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>FAB Flow Mockup - AccessiblePush</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
:root {
  --bg-dark: #121212;
  --surface: #1a1a1a;
  --surface-elevated: #242424;
  --accent: #4CAF50;
  --text-primary: #ffffff;
  --text-secondary: #aaaaaa;
  --danger: #f44336;
  --warning: #ff9800;
  --info: #2196F3;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: var(--bg-dark);
  color: var(--text-primary);
  height: 100vh;
  overflow: hidden;
}

/* RTL Support */
[dir="rtl"] {
  font-family: 'Segoe UI', Tahoma, Arial, sans-serif;
}

[dir="rtl"] .overlay-header {
  flex-direction: row-reverse;
}

[dir="rtl"] .sheet-header {
  flex-direction: row-reverse;
}

[dir="rtl"] .gps-display {
  flex-direction: row-reverse;
}

[dir="rtl"] .field-row {
  flex-direction: row-reverse;
}

/* --- LANGUAGE TOGGLE --- */
.lang-toggle {
  position: absolute;
  top: 12px;
  right: 12px;
  z-index: 1060;
  display: flex;
  background: var(--surface);
  border-radius: 8px;
  overflow: hidden;
  border: 1px solid #333;
}

[dir="rtl"] .lang-toggle {
  right: auto;
  left: 12px;
}

.lang-btn {
  padding: 8px 12px;
  background: transparent;
  border: none;
  color: var(--text-secondary);
  font-size: 12px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
}

.lang-btn.active {
  background: var(--accent);
  color: white;
}

/* --- MAIN LAYOUT --- */
.app-container {
  display: flex;
  flex-direction: column;
  height: 100vh;
}

.map-area {
  flex: 1;
  position: relative;
  overflow: hidden;
}

#map {
  width: 100%;
  height: 100%;
}

/* --- GLOBAL BOTTOM NAV --- */
.bottom-nav {
  display: flex;
  justify-content: space-around;
  align-items: center;
  background: var(--surface);
  padding: 8px 0 12px;
  border-top: 1px solid #333;
  position: relative;
  z-index: 1000;
}

.nav-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 2px;
  color: var(--text-secondary);
  font-size: 10px;
  background: none;
  border: none;
  cursor: pointer;
  padding: 4px 12px;
  transition: color 0.2s;
}

.nav-item.active { color: var(--accent); }
.nav-item:hover { color: var(--text-primary); }

.nav-item svg {
  width: 22px;
  height: 22px;
  fill: currentColor;
}

/* --- CENTERED FAB (above bottom nav) --- */
.main-fab {
  position: absolute;
  bottom: 70px;
  left: 50%;
  transform: translateX(-50%);
  width: 64px;
  height: 64px;
  border-radius: 50%;
  background: var(--accent);
  border: none;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 4px 20px rgba(76, 175, 80, 0.5);
  z-index: 1100;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.main-fab:hover {
  transform: translateX(-50%) scale(1.08);
  box-shadow: 0 6px 28px rgba(76, 175, 80, 0.6);
}

.main-fab:active {
  transform: translateX(-50%) scale(0.95);
}

.main-fab svg {
  width: 32px;
  height: 32px;
  fill: white;
  transition: transform 0.3s;
}

.main-fab.open svg {
  transform: rotate(45deg);
}

/* --- ELEMENT PICKER OVERLAY --- */
.element-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.97);
  z-index: 2000;
  display: flex;
  flex-direction: column;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s;
}

.element-overlay.visible {
  opacity: 1;
  pointer-events: auto;
}

.overlay-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 20px;
  border-bottom: 1px solid #333;
}

.overlay-title {
  font-size: 20px;
  font-weight: 700;
}

.overlay-close {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: var(--surface-elevated);
  border: none;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
}

.overlay-close svg {
  width: 24px;
  height: 24px;
  fill: currentColor;
}

.element-grid {
  flex: 1;
  overflow-y: auto;
  padding: 16px;
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
  align-content: start;
}

.element-btn {
  aspect-ratio: 1;
  background: var(--surface-elevated);
  border: 2px solid #333;
  border-radius: 16px;
  cursor: pointer;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 8px;
  padding: 10px 6px;
  transition: all 0.2s;
}

.element-btn:hover {
  background: #2a2a2a;
  border-color: var(--accent);
  transform: scale(1.02);
}

.element-btn:active {
  transform: scale(0.96);
}

.element-btn svg {
  width: 36px;
  height: 36px;
  fill: white;
}

.element-label {
  font-size: 13px;
  font-weight: 700;
  color: white;
  text-align: center;
  line-height: 1.2;
}

/* Color coding for element types */
.element-btn[data-type="capture"] { border-color: #9c27b0; }
.element-btn[data-type="capture"] svg { fill: #ce93d8; }
.element-btn[data-type="hazard"] { border-color: var(--danger); }
.element-btn[data-type="hazard"] svg { fill: #ef9a9a; }
.element-btn[data-type="accessibility"] { border-color: var(--info); }
.element-btn[data-type="accessibility"] svg { fill: #90caf9; }
.element-btn[data-type="terrain"] { border-color: var(--warning); }
.element-btn[data-type="terrain"] svg { fill: #ffcc80; }

/* --- BOTTOM SHEET MODAL --- */
.bottom-sheet-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.6);
  z-index: 3000;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s;
}

.bottom-sheet-backdrop.visible {
  opacity: 1;
  pointer-events: auto;
}

.bottom-sheet {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: var(--surface);
  border-radius: 20px 20px 0 0;
  z-index: 3001;
  transform: translateY(100%);
  transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1);
  max-height: 85vh;
  display: flex;
  flex-direction: column;
}

.bottom-sheet.visible {
  transform: translateY(0);
}

.sheet-handle {
  width: 40px;
  height: 4px;
  background: #666;
  border-radius: 2px;
  margin: 12px auto;
}

.sheet-header {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 0 20px 16px;
  border-bottom: 1px solid #333;
}

.sheet-icon {
  width: 32px;
  height: 32px;
}

.sheet-icon svg {
  width: 100%;
  height: 100%;
  fill: white;
}

.sheet-title {
  flex: 1;
  font-size: 20px;
  font-weight: 700;
}

.sheet-close {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background: var(--surface-elevated);
  border: none;
  cursor: pointer;
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
}

.sheet-close svg {
  width: 20px;
  height: 20px;
  fill: currentColor;
}

.sheet-content {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
}

/* --- FORM ELEMENTS --- */
.form-section {
  margin-bottom: 20px;
}

.form-label {
  display: block;
  font-size: 12px;
  font-weight: 600;
  color: var(--text-secondary);
  margin-bottom: 8px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* Photo capture */
.photo-capture {
  display: flex;
  gap: 12px;
}

.photo-btn {
  flex: 1;
  height: 80px;
  border-radius: 12px;
  background: var(--surface-elevated);
  border: 2px dashed #444;
  cursor: pointer;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 6px;
  color: var(--text-secondary);
  transition: all 0.2s;
}

.photo-btn:hover {
  border-color: var(--accent);
  color: var(--accent);
}

.photo-btn svg {
  width: 28px;
  height: 28px;
  fill: currentColor;
}

.photo-btn-text {
  font-size: 12px;
  font-weight: 600;
}

/* GPS display */
.gps-display {
  display: flex;
  align-items: center;
  gap: 12px;
  background: var(--surface-elevated);
  padding: 12px 16px;
  border-radius: 12px;
}

.gps-icon {
  width: 24px;
  height: 24px;
}

.gps-icon svg {
  width: 100%;
  height: 100%;
  fill: var(--accent);
}

.gps-coords {
  flex: 1;
}

.gps-lat, .gps-lng {
  font-size: 13px;
  font-family: monospace;
}

.gps-accuracy {
  font-size: 11px;
  color: var(--text-secondary);
}

/* Element-specific fields */
.field-row {
  display: flex;
  gap: 12px;
  margin-bottom: 12px;
}

.field-group {
  flex: 1;
}

.field-input {
  width: 100%;
  padding: 12px 16px;
  background: var(--surface-elevated);
  border: 1px solid #333;
  border-radius: 12px;
  color: white;
  font-size: 14px;
}

.field-input:focus {
  outline: none;
  border-color: var(--accent);
}

.field-select {
  width: 100%;
  padding: 12px 16px;
  background: var(--surface-elevated);
  border: 1px solid #333;
  border-radius: 12px;
  color: white;
  font-size: 14px;
  cursor: pointer;
}

/* Toggle chips */
.toggle-chips {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.toggle-chip {
  padding: 10px 16px;
  background: var(--surface-elevated);
  border: 1px solid #444;
  border-radius: 20px;
  color: var(--text-secondary);
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
}

.toggle-chip:hover {
  border-color: var(--accent);
}

.toggle-chip.selected {
  background: var(--accent);
  border-color: var(--accent);
  color: white;
}

/* Notes textarea */
.notes-textarea {
  width: 100%;
  min-height: 100px;
  padding: 12px 16px;
  background: var(--surface-elevated);
  border: 1px solid #333;
  border-radius: 12px;
  color: white;
  font-size: 14px;
  resize: vertical;
  font-family: inherit;
}

.notes-textarea:focus {
  outline: none;
  border-color: var(--accent);
}

/* Submit button */
.sheet-footer {
  padding: 16px 20px;
  border-top: 1px solid #333;
}

.submit-btn {
  width: 100%;
  padding: 16px;
  background: var(--accent);
  border: none;
  border-radius: 12px;
  color: white;
  font-size: 16px;
  font-weight: 700;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  transition: all 0.2s;
}

.submit-btn:hover {
  background: #43a047;
}

.submit-btn:active {
  transform: scale(0.98);
}

.submit-btn svg {
  width: 20px;
  height: 20px;
  fill: currentColor;
}

/* --- MAP CONTROLS --- */
.map-controls {
  position: absolute;
  right: 12px;
  top: 50%;
  transform: translateY(-50%);
  display: flex;
  flex-direction: column;
  gap: 8px;
  z-index: 1050;
}

[dir="rtl"] .map-controls {
  right: auto;
  left: 12px;
}

.map-btn {
  width: 44px;
  height: 44px;
  border-radius: 12px;
  background: rgba(26, 26, 26, 0.95);
  border: 1px solid #333;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  backdrop-filter: blur(10px);
}

.map-btn svg {
  width: 22px;
  height: 22px;
  fill: currentColor;
}

/* --- RECORDING INDICATOR --- */
.recording-indicator {
  position: absolute;
  top: 12px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(244, 67, 54, 0.9);
  padding: 8px 20px;
  border-radius: 20px;
  display: flex;
  align-items: center;
  gap: 8px;
  z-index: 1050;
}

.rec-dot {
  width: 10px;
  height: 10px;
  background: white;
  border-radius: 50%;
  animation: pulse 1s infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.3; }
}

.rec-text {
  font-size: 13px;
  font-weight: 600;
}

.rec-time {
  font-family: monospace;
}
  </style>
</head>
<body>
  <div class="app-container">
    <!-- Map Area -->
    <div class="map-area">
      <div id="map"></div>

      <!-- Language Toggle -->
      <div class="lang-toggle">
        <button class="lang-btn active" data-lang="en">EN</button>
        <button class="lang-btn" data-lang="he">עב</button>
      </div>

      <!-- Recording indicator -->
      <div class="recording-indicator">
        <div class="rec-dot"></div>
        <span class="rec-text" data-i18n="recording">Recording</span>
        <span class="rec-time">12:34</span>
      </div>

      <!-- Map controls -->
      <div class="map-controls">
        <button class="map-btn">
          <svg viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>
        </button>
        <button class="map-btn">
          <svg viewBox="0 0 24 24"><path d="M12 2L4.5 20.29l.71.71L12 18l6.79 3 .71-.71z"/></svg>
        </button>
        <button class="map-btn">
          <svg viewBox="0 0 24 24"><path d="M21 6H3c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 10H3V8h2v4h2V8h2v4h2V8h2v4h2V8h2v4h2V8h2v8z"/></svg>
        </button>
      </div>

      <!-- Main FAB -->
      <button class="main-fab" id="mainFab" aria-label="Add element">
        <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
      </button>
    </div>

    <!-- Global Bottom Nav -->
    <nav class="bottom-nav">
      <button class="nav-item active">
        <svg viewBox="0 0 24 24"><path d="M20.5 3l-.16.03L15 5.1 9 3 3.36 4.9c-.21.07-.36.25-.36.48V20.5c0 .28.22.5.5.5l.16-.03L9 18.9l6 2.1 5.64-1.9c.21-.07.36-.25.36-.48V3.5c0-.28-.22-.5-.5-.5zM15 19l-6-2.11V5l6 2.11V19z"/></svg>
        <span data-i18n="nav_map">Map</span>
      </button>
      <button class="nav-item">
        <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/></svg>
        <span data-i18n="nav_stats">Stats</span>
      </button>
      <button class="nav-item">
        <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 14H6v-2h6v2zm3-4H6v-2h9v2zm3-4H6V7h12v2z"/></svg>
        <span data-i18n="nav_elements">Elements</span>
      </button>
      <button class="nav-item">
        <svg viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
        <span data-i18n="nav_settings">Settings</span>
      </button>
    </nav>
  </div>

  <!-- Element Picker Overlay -->
  <div class="element-overlay" id="elementOverlay">
    <div class="overlay-header">
      <span class="overlay-title" data-i18n="add_element">Add Element</span>
      <button class="overlay-close" id="overlayClose">
        <svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
      </button>
    </div>
    <div class="element-grid" id="elementGrid">
      <!-- Elements will be populated by JavaScript -->
    </div>
  </div>

  <!-- Bottom Sheet Backdrop -->
  <div class="bottom-sheet-backdrop" id="sheetBackdrop"></div>

  <!-- Bottom Sheet Modal -->
  <div class="bottom-sheet" id="bottomSheet">
    <div class="sheet-handle"></div>
    <div class="sheet-header">
      <span class="sheet-icon" id="sheetIcon"></span>
      <span class="sheet-title" id="sheetTitle">Element</span>
      <button class="sheet-close" id="sheetClose">
        <svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
      </button>
    </div>
    <div class="sheet-content" id="sheetContent">
      <!-- Dynamic content based on element type -->
    </div>
    <div class="sheet-footer">
      <button class="submit-btn" id="submitBtn">
        <span data-i18n="save_element">Save Element</span>
        <svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
      </button>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
// ============================================
// SVG ICONS (white on black style)
// ============================================
const icons = {
  photo: '<svg viewBox="0 0 24 24"><path d="M12 12m-3.2 0a3.2 3.2 0 1 0 6.4 0a3.2 3.2 0 1 0 -6.4 0"/><path d="M9 2L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"/></svg>',
  note: '<svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2zm0-4H7V7h10v2z"/></svg>',
  voice: '<svg viewBox="0 0 24 24"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.91-3c-.49 0-.9.36-.98.85C16.52 14.2 14.47 16 12 16s-4.52-1.8-4.93-4.15c-.08-.49-.49-.85-.98-.85-.61 0-1.09.54-1 1.14.49 3 2.89 5.35 5.91 5.78V20c0 .55.45 1 1 1s1-.45 1-1v-2.08c3.02-.43 5.42-2.78 5.91-5.78.1-.6-.39-1.14-1-1.14z"/></svg>',
  bench: '<svg viewBox="0 0 24 24"><path d="M4 18v3h3v-3h10v3h3v-3h1v-2H3v2h1zm15-8h-2V8c0-1.1-.9-2-2-2H9c-1.1 0-2 .9-2 2v2H5c-1.1 0-2 .9-2 2v3h18v-3c0-1.1-.9-2-2-2z"/></svg>',
  water: '<svg viewBox="0 0 24 24"><path d="M12 2c-5.33 4.55-8 8.48-8 11.8 0 4.98 3.8 8.2 8 8.2s8-3.22 8-8.2c0-3.32-2.67-7.25-8-11.8zm0 18c-3.35 0-6-2.57-6-6.2 0-2.34 1.95-5.44 6-9.14 4.05 3.7 6 6.79 6 9.14 0 3.63-2.65 6.2-6 6.2z"/><path d="M12 18c1.93 0 3.5-1.57 3.5-3.5 0-.87-.7-2.32-2.07-4.06L12 8.66l-1.43 1.78C9.2 12.18 8.5 13.63 8.5 14.5c0 1.93 1.57 3.5 3.5 3.5z"/></svg>',
  restroom: '<svg viewBox="0 0 24 24"><path d="M5.5 22v-7.5H4V9c0-1.1.9-2 2-2h3c1.1 0 2 .9 2 2v5.5H9.5V22h-4zM18 22v-6h3l-2.54-7.63C18.18 7.55 17.42 7 16.56 7h-.12c-.86 0-1.63.55-1.9 1.37L12 16h3v6h3zM7.5 6c1.11 0 2-.89 2-2s-.89-2-2-2-2 .89-2 2 .89 2 2 2zm9 0c1.11 0 2-.89 2-2s-.89-2-2-2-2 .89-2 2 .89 2 2 2z"/></svg>',
  viewpoint: '<svg viewBox="0 0 24 24"><path d="M14 6l-3.75 5 2.85 3.8-1.6 1.2C9.81 13.75 7 10 7 10l-6 8h22L14 6z"/></svg>',
  picnic: '<svg viewBox="0 0 24 24"><path d="M2.53 19.65l1.34.56v-9.03l-2.43 5.86c-.41 1.02.08 2.19 1.09 2.61zm19.5-3.7L17.07 3.98c-.31-.75-1.04-1.21-1.81-1.23-.26 0-.53.04-.79.15L7.1 5.95c-.75.31-1.21 1.03-1.23 1.8-.01.27.04.54.15.8l4.96 11.97c.31.76 1.05 1.22 1.83 1.23.26 0 .52-.05.77-.15l7.36-3.05c1.02-.42 1.51-1.59 1.09-2.6zM7.88 8.75c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm-2 11v-4.5H4v4.5c0 .83.67 1.5 1.5 1.5S7 20.33 7 19.5v-4.5H5.12v4.5c0 .28-.22.5-.5.5s-.5-.22-.5-.5z"/></svg>',
  steep: '<svg viewBox="0 0 24 24"><path d="M14 6l-4.22 5.63 1.25 1.67L14 9.33 19 16h-8.46l-4.01-5.37L1 18h22L14 6zM5 16l1.52-2.03L8.04 16H5z"/></svg>',
  accessibility: '<svg viewBox="0 0 24 24"><path d="M12 2c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2zm9 7h-6v13h-2v-6h-2v6H9V9H3V7h18v2z"/></svg>',
  hazard: '<svg viewBox="0 0 24 24"><path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/></svg>',
  info: '<svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>',
  shade: '<svg viewBox="0 0 24 24"><path d="M22 9.74l-2 1V3H4v8.26l-2-1v1.98l2 1.02v.74l-2 1v1.98l2 1.02V21h16v-4.02l2-1v-1.98l-2-1v-.74l2-1V9.74zM6 19V5h4v14H6zm10 0h-4V5h4v14z"/></svg>',
  parking: '<svg viewBox="0 0 24 24"><path d="M13 3H6v18h4v-6h3c3.31 0 6-2.69 6-6s-2.69-6-6-6zm.2 8H10V7h3.2c1.1 0 2 .9 2 2s-.9 2-2 2z"/></svg>',
  junction: '<svg viewBox="0 0 24 24"><path d="M14 7l5 5-5 5V7zm-4 0v10l-5-5 5-5z"/></svg>',
  steps: '<svg viewBox="0 0 24 24"><path d="M21 5H3v14h18V5zM5 7h4v2H5V7zm0 4h4v2H5v-2zm0 4h4v2H5v-2zm14 2h-4v-2h4v2zm0-4h-4v-2h4v2zm0-4h-4V7h4v2z"/></svg>',
  gate: '<svg viewBox="0 0 24 24"><path d="M21 10H3V8h18v2zm0 4H3v-2h18v2zM5 22H3V2h2v20zm16 0h-2V2h2v20z"/></svg>',
  bridge: '<svg viewBox="0 0 24 24"><path d="M7 21H3v-8c0-2.21 1.79-4 4-4h3v-3l4 4-4 4v-3H7c-1.1 0-2 .9-2 2v6h2v2zm10 0h4v-8c0-2.21-1.79-4-4-4h-3v-3l-4 4 4 4v-3h3c1.1 0 2 .9 2 2v6h-2v2z"/></svg>',
  crossing: '<svg viewBox="0 0 24 24"><path d="M6 6h12v2H6V6zm0 4h12v2H6v-2zm0 4h12v2H6v-2zm0 4h12v2H6v-2z"/><path d="M4 4v16h2V4H4zm14 0v16h2V4h-2z"/></svg>',
  camera: '<svg viewBox="0 0 24 24"><path d="M12 12m-3.2 0a3.2 3.2 0 1 0 6.4 0a3.2 3.2 0 1 0 -6.4 0"/><path d="M9 2L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9z"/></svg>',
  gallery: '<svg viewBox="0 0 24 24"><path d="M22 16V4c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2zm-11-4l2.03 2.71L16 11l4 5H8l3-4zM2 6v14c0 1.1.9 2 2 2h14v-2H4V6H2z"/></svg>',
  mic: '<svg viewBox="0 0 24 24"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/><path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/></svg>',
  location: '<svg viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>',
  check: '<svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>'
};

// ============================================
// TRANSLATIONS
// ============================================
const translations = {
  en: {
    // Navigation
    nav_map: 'Map',
    nav_stats: 'Stats',
    nav_elements: 'Elements',
    nav_settings: 'Settings',
    recording: 'Recording',
    add_element: 'Add Element',
    save_element: 'Save Element',

    // Form labels
    location: 'Location',
    notes_optional: 'Notes (Optional)',
    notes_placeholder: 'Add any additional details...',
    photo_optional: 'Photo (Optional)',
    photo_recommended: 'Photo (Recommended)',
    capture_photo: 'Capture Photo',
    take_photo: 'Take Photo',
    gallery: 'Gallery',
    panorama: 'Panorama',
    tap_record: 'Tap to Record',

    // Elements
    el_photo: 'Photo',
    el_note: 'Note',
    el_voice: 'Voice Note',
    el_bench: 'Rest Bench',
    el_water: 'Water',
    el_restroom: 'Restroom',
    el_viewpoint: 'Viewpoint',
    el_picnic: 'Picnic Area',
    el_steep: 'Steep Section',
    el_accessibility: 'Accessibility',
    el_hazard: 'Hazard',
    el_info: 'Information',
    el_shade: 'Shade',
    el_parking: 'Parking',
    el_junction: 'Junction',
    el_steps: 'Steps/Stairs',
    el_gate: 'Gate/Barrier',
    el_bridge: 'Bridge',
    el_crossing: 'Road Crossing',

    // Form fields - Note
    note_type: 'Note Type',
    observation: 'Observation',
    warning: 'Warning',
    tip: 'Tip',

    // Form fields - Voice
    recording_label: 'Recording',

    // Form fields - Bench
    seating_capacity: 'Seating Capacity',
    features: 'Features',
    backrest: 'Backrest',
    armrests: 'Armrests',
    shaded: 'Shaded',
    wheelchair_space: 'Wheelchair Space',
    condition: 'Condition',
    good: 'Good',
    fair: 'Fair',
    poor: 'Poor',

    // Form fields - Water
    water_status: 'Water Status',
    working: 'Working',
    not_working: 'Not Working',
    seasonal: 'Seasonal',
    wheelchair_height: 'Wheelchair Height',
    dog_bowl: 'Dog Bowl',
    bottle_fill: 'Bottle Fill',

    // Form fields - Restroom
    type: 'Type',
    permanent: 'Permanent',
    portable: 'Portable',
    accessible: 'Accessible',
    not_accessible: 'Not Accessible',
    unknown: 'Unknown',
    facilities: 'Facilities',
    grab_bars: 'Grab Bars',
    changing_table: 'Changing Table',
    sink: 'Sink',

    // Form fields - Viewpoint
    capture_view: 'Capture View',
    view_direction: 'View Direction',
    north: 'North',
    east: 'East',
    south: 'South',
    west: 'West',
    features_visible: 'Features Visible',
    features_placeholder: 'e.g., Mountain peaks, valley, lake...',

    // Form fields - Picnic
    tables: 'Tables',
    amenities: 'Amenities',
    bbq_grill: 'BBQ/Grill',
    trash_bins: 'Trash Bins',
    wheelchair_access: 'Wheelchair Access',

    // Form fields - Steep
    direction: 'Direction',
    uphill: 'Uphill',
    downhill: 'Downhill',
    both: 'Both',
    difficulty: 'Difficulty',
    moderate: 'Moderate',
    steep: 'Steep',
    very_steep: 'Very Steep',
    estimated_length: 'Estimated Length',

    // Form fields - Accessibility
    issue_type: 'Issue Type',
    surface: 'Surface',
    obstacle: 'Obstacle',
    width: 'Width',
    slope: 'Slope',
    surface_type: 'Surface Type',
    paved: 'Paved',
    gravel: 'Gravel',
    dirt: 'Dirt',
    uneven: 'Uneven',
    path_width: 'Path Width',
    wide: 'Wide (2m+)',
    standard: 'Standard (1-2m)',
    narrow: 'Narrow (<1m)',

    // Form fields - Hazard
    hazard_type: 'Hazard Type',
    fallen_tree: 'Fallen Tree',
    erosion: 'Erosion',
    flooding: 'Flooding',
    wildlife: 'Wildlife',
    severity: 'Severity',
    low: 'Low',
    medium: 'Medium',
    high: 'High',
    trail_closed: 'Trail Closed',

    // Form fields - Info
    trail_sign: 'Trail Sign',
    info_board: 'Info Board',
    mile_marker: 'Mile Marker',
    other: 'Other',

    // Form fields - Shade
    shade_coverage: 'Shade Coverage',
    partial: 'Partial',
    full: 'Full',
    seating_available: 'Seating Available',
    yes: 'Yes',
    no: 'No',

    // Form fields - Parking
    parking_type: 'Parking Type',
    lot: 'Lot',
    street: 'Street',
    trailhead: 'Trailhead',
    accessible_spots: 'Accessible Spots',
    paved_surface: 'Paved Surface',
    dropoff_zone: 'Drop-off Zone',
    fee: 'Fee',
    free: 'Free',
    paid: 'Paid',
    permit_required: 'Permit Required',

    // Form fields - Junction
    num_paths: 'Number of Paths',
    way_2: '2-way',
    way_3: '3-way',
    way_4plus: '4+ way',
    signage: 'Signage',
    clear_signs: 'Clear Signs',
    partial_signs: 'Partial Signs',
    no_signs: 'No Signs',
    trail_names: 'Trail Names',
    trail_names_placeholder: 'e.g., Main Trail, Loop Trail',

    // Form fields - Steps
    step_count: 'Step Count',
    count_placeholder: 'Number of steps',
    handrail: 'Handrail',
    handrail_both: 'Both Sides',
    handrail_one: 'One Side',
    handrail_none: 'None',
    alt_ramp: 'Alternative Ramp',
    available: 'Available',
    not_available: 'Not Available',

    // Form fields - Gate
    gate_type: 'Gate Type',
    gate: 'Gate',
    barrier: 'Barrier',
    bollards: 'Bollards',
    turnstile: 'Turnstile',
    wheelchair_passable: 'Wheelchair Passable',
    locked: 'Locked Status',
    unlocked: 'Unlocked',
    locked_status: 'Locked',
    varies: 'Varies',

    // Form fields - Bridge
    bridge_width: 'Bridge Width',
    wide_bridge: 'Wide (2m+)',
    standard_bridge: 'Standard (1-2m)',
    narrow_bridge: 'Narrow (<1m)',
    railings: 'Railings',
    railings_both: 'Both Sides',
    railings_one: 'One Side',
    railings_none: 'None',
    bridge_surface: 'Surface',
    wood: 'Wood',
    metal: 'Metal',
    concrete: 'Concrete',

    // Form fields - Crossing
    crossing_type: 'Crossing Type',
    crosswalk: 'Crosswalk',
    signal: 'Traffic Signal',
    unmarked: 'Unmarked',
    underpass: 'Underpass',
    traffic_level: 'Traffic Level',
    light: 'Light',
    heavy: 'Heavy',
    curb_cuts: 'Curb Cuts',
    curb_both: 'Both Sides',
    curb_one: 'One Side',
    curb_none: 'None'
  },
  he: {
    // Navigation
    nav_map: 'מפה',
    nav_stats: 'נתונים',
    nav_elements: 'אלמנטים',
    nav_settings: 'הגדרות',
    recording: 'מקליט',
    add_element: 'הוסף אלמנט',
    save_element: 'שמור אלמנט',

    // Form labels
    location: 'מיקום',
    notes_optional: 'הערות (אופציונלי)',
    notes_placeholder: 'הוסף פרטים נוספים...',
    photo_optional: 'תמונה (אופציונלי)',
    photo_recommended: 'תמונה (מומלץ)',
    capture_photo: 'צלם תמונה',
    take_photo: 'צלם',
    gallery: 'גלריה',
    panorama: 'פנורמה',
    tap_record: 'לחץ להקלטה',

    // Elements
    el_photo: 'תמונה',
    el_note: 'הערה',
    el_voice: 'הערה קולית',
    el_bench: 'ספסל מנוחה',
    el_water: 'מים',
    el_restroom: 'שירותים',
    el_viewpoint: 'תצפית',
    el_picnic: 'אזור פיקניק',
    el_steep: 'מקטע תלול',
    el_accessibility: 'נגישות',
    el_hazard: 'סכנה',
    el_info: 'מידע',
    el_shade: 'צל',
    el_parking: 'חניה',
    el_junction: 'צומת שבילים',
    el_steps: 'מדרגות',
    el_gate: 'שער/מחסום',
    el_bridge: 'גשר',
    el_crossing: 'מעבר כביש',

    // Form fields - Note
    note_type: 'סוג הערה',
    observation: 'תצפית',
    warning: 'אזהרה',
    tip: 'טיפ',

    // Form fields - Voice
    recording_label: 'הקלטה',

    // Form fields - Bench
    seating_capacity: 'מספר מקומות',
    features: 'תכונות',
    backrest: 'משענת גב',
    armrests: 'משענות יד',
    shaded: 'מוצל',
    wheelchair_space: 'מקום לכיסא גלגלים',
    condition: 'מצב',
    good: 'טוב',
    fair: 'סביר',
    poor: 'גרוע',

    // Form fields - Water
    water_status: 'מצב מים',
    working: 'פעיל',
    not_working: 'לא פעיל',
    seasonal: 'עונתי',
    wheelchair_height: 'גובה כיסא גלגלים',
    dog_bowl: 'קערת כלבים',
    bottle_fill: 'מילוי בקבוק',

    // Form fields - Restroom
    type: 'סוג',
    permanent: 'קבוע',
    portable: 'נייד',
    accessible: 'נגיש',
    not_accessible: 'לא נגיש',
    unknown: 'לא ידוע',
    facilities: 'מתקנים',
    grab_bars: 'מוטות אחיזה',
    changing_table: 'שולחן החתלה',
    sink: 'כיור',

    // Form fields - Viewpoint
    capture_view: 'צלם נוף',
    view_direction: 'כיוון מבט',
    north: 'צפון',
    east: 'מזרח',
    south: 'דרום',
    west: 'מערב',
    features_visible: 'אובייקטים נראים',
    features_placeholder: 'לדוגמה: פסגות הרים, עמק, אגם...',

    // Form fields - Picnic
    tables: 'שולחנות',
    amenities: 'מתקנים',
    bbq_grill: 'גריל/מנגל',
    trash_bins: 'פחי אשפה',
    wheelchair_access: 'גישה לכיסא גלגלים',

    // Form fields - Steep
    direction: 'כיוון',
    uphill: 'עלייה',
    downhill: 'ירידה',
    both: 'שניהם',
    difficulty: 'רמת קושי',
    moderate: 'בינוני',
    steep: 'תלול',
    very_steep: 'תלול מאוד',
    estimated_length: 'אורך משוער',

    // Form fields - Accessibility
    issue_type: 'סוג בעיה',
    surface: 'משטח',
    obstacle: 'מכשול',
    width: 'רוחב',
    slope: 'שיפוע',
    surface_type: 'סוג משטח',
    paved: 'סלול',
    gravel: 'חצץ',
    dirt: 'עפר',
    uneven: 'לא ישר',
    path_width: 'רוחב שביל',
    wide: 'רחב (2מ+)',
    standard: 'סטנדרטי (1-2מ)',
    narrow: 'צר (<1מ)',

    // Form fields - Hazard
    hazard_type: 'סוג סכנה',
    fallen_tree: 'עץ קרוס',
    erosion: 'סחף',
    flooding: 'הצפה',
    wildlife: 'חיות בר',
    severity: 'חומרה',
    low: 'נמוך',
    medium: 'בינוני',
    high: 'גבוה',
    trail_closed: 'שביל סגור',

    // Form fields - Info
    trail_sign: 'שלט שביל',
    info_board: 'לוח מידע',
    mile_marker: 'סימון מרחק',
    other: 'אחר',

    // Form fields - Shade
    shade_coverage: 'כיסוי צל',
    partial: 'חלקי',
    full: 'מלא',
    seating_available: 'ישיבה זמינה',
    yes: 'כן',
    no: 'לא',

    // Form fields - Parking
    parking_type: 'סוג חניה',
    lot: 'מגרש',
    street: 'רחוב',
    trailhead: 'תחילת שביל',
    accessible_spots: 'מקומות נגישים',
    paved_surface: 'משטח סלול',
    dropoff_zone: 'אזור הורדה',
    fee: 'תשלום',
    free: 'חינם',
    paid: 'בתשלום',
    permit_required: 'נדרש היתר',

    // Form fields - Junction
    num_paths: 'מספר שבילים',
    way_2: '2 כיוונים',
    way_3: '3 כיוונים',
    way_4plus: '4+ כיוונים',
    signage: 'שילוט',
    clear_signs: 'שילוט ברור',
    partial_signs: 'שילוט חלקי',
    no_signs: 'ללא שילוט',
    trail_names: 'שמות שבילים',
    trail_names_placeholder: 'לדוגמה: שביל ראשי, מסלול טבעת',

    // Form fields - Steps
    step_count: 'מספר מדרגות',
    count_placeholder: 'מספר מדרגות',
    handrail: 'מעקה',
    handrail_both: 'משני הצדדים',
    handrail_one: 'צד אחד',
    handrail_none: 'ללא',
    alt_ramp: 'רמפה חלופית',
    available: 'זמין',
    not_available: 'לא זמין',

    // Form fields - Gate
    gate_type: 'סוג שער',
    gate: 'שער',
    barrier: 'מחסום',
    bollards: 'עמודונים',
    turnstile: 'קרוסלה',
    wheelchair_passable: 'מעבר לכיסא גלגלים',
    locked: 'מצב נעילה',
    unlocked: 'פתוח',
    locked_status: 'נעול',
    varies: 'משתנה',

    // Form fields - Bridge
    bridge_width: 'רוחב גשר',
    wide_bridge: 'רחב (2מ+)',
    standard_bridge: 'סטנדרטי (1-2מ)',
    narrow_bridge: 'צר (<1מ)',
    railings: 'מעקות',
    railings_both: 'משני הצדדים',
    railings_one: 'צד אחד',
    railings_none: 'ללא',
    bridge_surface: 'משטח',
    wood: 'עץ',
    metal: 'מתכת',
    concrete: 'בטון',

    // Form fields - Crossing
    crossing_type: 'סוג מעבר',
    crosswalk: 'מעבר חציה',
    signal: 'רמזור',
    unmarked: 'לא מסומן',
    underpass: 'מעבר תחתון',
    traffic_level: 'עומס תנועה',
    light: 'קל',
    heavy: 'כבד',
    curb_cuts: 'הורדות מדרכה',
    curb_both: 'משני הצדדים',
    curb_one: 'צד אחד',
    curb_none: 'ללא'
  }
};

// ============================================
// ELEMENT DEFINITIONS (19 total)
// ============================================
const elements = [
  // Capture (3)
  { id: 'photo', icon: 'photo', type: 'capture', labelKey: 'el_photo' },
  { id: 'note', icon: 'note', type: 'capture', labelKey: 'el_note' },
  { id: 'voice', icon: 'voice', type: 'capture', labelKey: 'el_voice' },
  // Rest & Comfort (4)
  { id: 'bench', icon: 'bench', labelKey: 'el_bench' },
  { id: 'picnic', icon: 'picnic', labelKey: 'el_picnic' },
  { id: 'shade', icon: 'shade', labelKey: 'el_shade' },
  { id: 'viewpoint', icon: 'viewpoint', labelKey: 'el_viewpoint' },
  // Water & Facilities (3)
  { id: 'water', icon: 'water', labelKey: 'el_water' },
  { id: 'restroom', icon: 'restroom', labelKey: 'el_restroom' },
  { id: 'parking', icon: 'parking', labelKey: 'el_parking' },
  // Terrain & Accessibility (6)
  { id: 'steep', icon: 'steep', type: 'terrain', labelKey: 'el_steep' },
  { id: 'steps', icon: 'steps', type: 'terrain', labelKey: 'el_steps' },
  { id: 'gate', icon: 'gate', type: 'terrain', labelKey: 'el_gate' },
  { id: 'bridge', icon: 'bridge', type: 'terrain', labelKey: 'el_bridge' },
  { id: 'crossing', icon: 'crossing', type: 'terrain', labelKey: 'el_crossing' },
  { id: 'accessibility', icon: 'accessibility', type: 'accessibility', labelKey: 'el_accessibility' },
  // Safety (3)
  { id: 'hazard', icon: 'hazard', type: 'hazard', labelKey: 'el_hazard' },
  { id: 'info', icon: 'info', labelKey: 'el_info' },
  { id: 'junction', icon: 'junction', labelKey: 'el_junction' }
];

// Current language
let currentLang = 'en';

// Get translation
function t(key) {
  return translations[currentLang][key] || key;
}

// ============================================
// FORM BUILDERS
// ============================================
function buildPhotoSection(isRecommended = false) {
  return `
    <div class="form-section">
      <label class="form-label" data-i18n="${isRecommended ? 'photo_recommended' : 'photo_optional'}">${t(isRecommended ? 'photo_recommended' : 'photo_optional')}</label>
      <div class="photo-capture">
        <button class="photo-btn"${isRecommended ? ' style="border-color: var(--danger);"' : ''}>
          ${icons.camera}
          <span class="photo-btn-text" data-i18n="take_photo">${t('take_photo')}</span>
        </button>
        <button class="photo-btn">
          ${icons.gallery}
          <span class="photo-btn-text" data-i18n="gallery">${t('gallery')}</span>
        </button>
      </div>
    </div>
  `;
}

function buildGpsSection() {
  return `
    <div class="form-section">
      <label class="form-label" data-i18n="location">${t('location')}</label>
      <div class="gps-display">
        <span class="gps-icon">${icons.location}</span>
        <div class="gps-coords">
          <div class="gps-lat">32.085312° N</div>
          <div class="gps-lng">34.781823° E</div>
        </div>
        <span class="gps-accuracy">±3m</span>
      </div>
    </div>
  `;
}

function buildNotesSection() {
  return `
    <div class="form-section">
      <label class="form-label" data-i18n="notes_optional">${t('notes_optional')}</label>
      <textarea class="notes-textarea" placeholder="${t('notes_placeholder')}" data-i18n-placeholder="notes_placeholder"></textarea>
    </div>
  `;
}

function buildChips(labelKey, options, multi = false) {
  const chips = options.map((opt, i) =>
    `<button class="toggle-chip${i === 0 ? ' selected' : ''}" data-i18n="${opt.key}">${t(opt.key)}</button>`
  ).join('');
  return `
    <div class="form-section">
      <label class="form-label" data-i18n="${labelKey}">${t(labelKey)}</label>
      <div class="toggle-chips${multi ? ' multi' : ''}">${chips}</div>
    </div>
  `;
}

// ============================================
// ELEMENT FORMS
// ============================================
const elementForms = {
  photo: () => `
    <div class="form-section">
      <label class="form-label" data-i18n="capture_photo">${t('capture_photo')}</label>
      <div class="photo-capture">
        <button class="photo-btn">${icons.camera}<span class="photo-btn-text" data-i18n="take_photo">${t('take_photo')}</span></button>
        <button class="photo-btn">${icons.gallery}<span class="photo-btn-text" data-i18n="gallery">${t('gallery')}</span></button>
      </div>
    </div>
  `,
  note: () => buildChips('note_type', [{key:'observation'},{key:'warning'},{key:'tip'}]),
  voice: () => `
    <div class="form-section">
      <label class="form-label" data-i18n="recording_label">${t('recording_label')}</label>
      <button class="photo-btn" style="height: 60px; border-style: solid; border-color: var(--danger);">
        ${icons.mic}
        <span class="photo-btn-text" data-i18n="tap_record">${t('tap_record')}</span>
      </button>
    </div>
  `,
  bench: () =>
    buildPhotoSection() +
    buildChips('seating_capacity', [{key:'1-2'},{key:'3-4'},{key:'5+'}].map(x=>({key:x.key,label:x.key}))) +
    buildChips('features', [{key:'backrest'},{key:'armrests'},{key:'shaded'},{key:'wheelchair_space'}], true) +
    buildChips('condition', [{key:'good'},{key:'fair'},{key:'poor'}]),
  water: () =>
    buildPhotoSection() +
    buildChips('water_status', [{key:'working'},{key:'not_working'},{key:'seasonal'}]) +
    buildChips('accessibility', [{key:'wheelchair_height'},{key:'dog_bowl'},{key:'bottle_fill'}], true),
  restroom: () =>
    buildPhotoSection() +
    buildChips('type', [{key:'permanent'},{key:'portable'}]) +
    buildChips('accessibility', [{key:'accessible'},{key:'not_accessible'},{key:'unknown'}]) +
    buildChips('facilities', [{key:'grab_bars'},{key:'changing_table'},{key:'sink'}], true),
  viewpoint: () => `
    <div class="form-section">
      <label class="form-label" data-i18n="capture_view">${t('capture_view')}</label>
      <div class="photo-capture">
        <button class="photo-btn">${icons.camera}<span class="photo-btn-text" data-i18n="take_photo">${t('take_photo')}</span></button>
        <button class="photo-btn">${icons.viewpoint}<span class="photo-btn-text" data-i18n="panorama">${t('panorama')}</span></button>
      </div>
    </div>
    ${buildChips('view_direction', [{key:'north'},{key:'east'},{key:'south'},{key:'west'}], true)}
    <div class="form-section">
      <label class="form-label" data-i18n="features_visible">${t('features_visible')}</label>
      <input type="text" class="field-input" placeholder="${t('features_placeholder')}" data-i18n-placeholder="features_placeholder">
    </div>
  `,
  picnic: () =>
    buildPhotoSection() +
    buildChips('tables', [{key:'1-2'},{key:'3-5'},{key:'6+'}].map(x=>({key:x.key}))) +
    buildChips('amenities', [{key:'shaded'},{key:'bbq_grill'},{key:'trash_bins'},{key:'wheelchair_access'}], true),
  steep: () =>
    buildPhotoSection() +
    buildChips('direction', [{key:'uphill'},{key:'downhill'},{key:'both'}]) +
    buildChips('difficulty', [{key:'moderate'},{key:'steep'},{key:'very_steep'}]) +
    `<div class="form-section">
      <label class="form-label" data-i18n="estimated_length">${t('estimated_length')}</label>
      <div class="field-row">
        <input type="number" class="field-input" placeholder="Distance" style="flex:2">
        <select class="field-select" style="flex:1"><option>m</option><option>ft</option></select>
      </div>
    </div>`,
  accessibility: () =>
    buildPhotoSection() +
    buildChips('issue_type', [{key:'surface'},{key:'obstacle'},{key:'width'},{key:'slope'}], true) +
    buildChips('surface_type', [{key:'paved'},{key:'gravel'},{key:'dirt'},{key:'uneven'}]) +
    buildChips('path_width', [{key:'wide'},{key:'standard'},{key:'narrow'}]),
  hazard: () =>
    buildPhotoSection(true) +
    buildChips('hazard_type', [{key:'fallen_tree'},{key:'erosion'},{key:'flooding'},{key:'wildlife'}]) +
    buildChips('severity', [{key:'low'},{key:'medium'},{key:'high'},{key:'trail_closed'}]),
  info: () =>
    buildPhotoSection() +
    buildChips('type', [{key:'trail_sign'},{key:'info_board'},{key:'mile_marker'},{key:'other'}]),
  shade: () =>
    buildPhotoSection() +
    buildChips('shade_coverage', [{key:'partial'},{key:'full'}]) +
    buildChips('seating_available', [{key:'yes'},{key:'no'}]),
  parking: () =>
    buildPhotoSection() +
    buildChips('parking_type', [{key:'lot'},{key:'street'},{key:'trailhead'}]) +
    buildChips('accessibility', [{key:'accessible_spots'},{key:'paved_surface'},{key:'dropoff_zone'}], true) +
    buildChips('fee', [{key:'free'},{key:'paid'},{key:'permit_required'}]),
  junction: () =>
    buildPhotoSection() +
    buildChips('num_paths', [{key:'way_2'},{key:'way_3'},{key:'way_4plus'}]) +
    buildChips('signage', [{key:'clear_signs'},{key:'partial_signs'},{key:'no_signs'}]) +
    `<div class="form-section">
      <label class="form-label" data-i18n="trail_names">${t('trail_names')}</label>
      <input type="text" class="field-input" placeholder="${t('trail_names_placeholder')}" data-i18n-placeholder="trail_names_placeholder">
    </div>`,
  steps: () =>
    buildPhotoSection() +
    `<div class="form-section">
      <label class="form-label" data-i18n="step_count">${t('step_count')}</label>
      <input type="number" class="field-input" placeholder="${t('count_placeholder')}" data-i18n-placeholder="count_placeholder">
    </div>` +
    buildChips('handrail', [{key:'handrail_both'},{key:'handrail_one'},{key:'handrail_none'}]) +
    buildChips('alt_ramp', [{key:'available'},{key:'not_available'}]) +
    buildChips('condition', [{key:'good'},{key:'fair'},{key:'poor'}]),
  gate: () =>
    buildPhotoSection() +
    buildChips('gate_type', [{key:'gate'},{key:'barrier'},{key:'bollards'},{key:'turnstile'}]) +
    buildChips('wheelchair_passable', [{key:'yes'},{key:'no'},{key:'unknown'}]) +
    buildChips('locked', [{key:'unlocked'},{key:'locked_status'},{key:'varies'}]),
  bridge: () =>
    buildPhotoSection() +
    buildChips('bridge_width', [{key:'wide_bridge'},{key:'standard_bridge'},{key:'narrow_bridge'}]) +
    buildChips('railings', [{key:'railings_both'},{key:'railings_one'},{key:'railings_none'}]) +
    buildChips('bridge_surface', [{key:'wood'},{key:'metal'},{key:'concrete'},{key:'other'}]) +
    buildChips('condition', [{key:'good'},{key:'fair'},{key:'poor'}]),
  crossing: () =>
    buildPhotoSection() +
    buildChips('crossing_type', [{key:'crosswalk'},{key:'signal'},{key:'unmarked'},{key:'underpass'}]) +
    buildChips('traffic_level', [{key:'light'},{key:'medium'},{key:'heavy'}]) +
    buildChips('curb_cuts', [{key:'curb_both'},{key:'curb_one'},{key:'curb_none'}])
};

// ============================================
// INITIALIZE MAP
// ============================================
const map = L.map('map', {
  zoomControl: false,
  attributionControl: false
}).setView([32.0853, 34.7818], 15);

L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);

// ============================================
// BUILD ELEMENT GRID
// ============================================
function buildElementGrid() {
  const grid = document.getElementById('elementGrid');
  grid.innerHTML = elements.map(el => `
    <button class="element-btn" data-element="${el.id}"${el.type ? ` data-type="${el.type}"` : ''}>
      ${icons[el.icon]}
      <span class="element-label" data-i18n="${el.labelKey}">${t(el.labelKey)}</span>
    </button>
  `).join('');

  // Add click handlers
  grid.querySelectorAll('.element-btn').forEach(btn => {
    btn.addEventListener('click', () => openBottomSheet(btn.dataset.element));
  });
}

// ============================================
// DOM ELEMENTS
// ============================================
const mainFab = document.getElementById('mainFab');
const elementOverlay = document.getElementById('elementOverlay');
const overlayClose = document.getElementById('overlayClose');
const sheetBackdrop = document.getElementById('sheetBackdrop');
const bottomSheet = document.getElementById('bottomSheet');
const sheetClose = document.getElementById('sheetClose');
const sheetIcon = document.getElementById('sheetIcon');
const sheetTitle = document.getElementById('sheetTitle');
const sheetContent = document.getElementById('sheetContent');

// ============================================
// OPEN/CLOSE HANDLERS
// ============================================
mainFab.addEventListener('click', () => {
  mainFab.classList.add('open');
  elementOverlay.classList.add('visible');
});

function closeOverlay() {
  mainFab.classList.remove('open');
  elementOverlay.classList.remove('visible');
}

overlayClose.addEventListener('click', closeOverlay);

function openBottomSheet(elementId) {
  const el = elements.find(e => e.id === elementId);
  if (!el || !elementForms[elementId]) return;

  sheetIcon.innerHTML = icons[el.icon];
  sheetTitle.textContent = t(el.labelKey);
  sheetTitle.setAttribute('data-i18n', el.labelKey);

  const formBuilder = elementForms[elementId];
  sheetContent.innerHTML = buildGpsSection() + formBuilder() + buildNotesSection();

  // Add chip toggle behavior
  sheetContent.querySelectorAll('.toggle-chips').forEach(group => {
    const isMulti = group.classList.contains('multi');
    group.querySelectorAll('.toggle-chip').forEach(chip => {
      chip.addEventListener('click', () => {
        if (!isMulti) {
          group.querySelectorAll('.toggle-chip').forEach(c => c.classList.remove('selected'));
        }
        chip.classList.toggle('selected');
      });
    });
  });

  closeOverlay();
  sheetBackdrop.classList.add('visible');
  bottomSheet.classList.add('visible');
}

function closeSheet() {
  sheetBackdrop.classList.remove('visible');
  bottomSheet.classList.remove('visible');
}

sheetClose.addEventListener('click', closeSheet);
sheetBackdrop.addEventListener('click', closeSheet);

// ============================================
// LANGUAGE SWITCHING
// ============================================
function updateAllTranslations() {
  // Update direction
  document.documentElement.dir = currentLang === 'he' ? 'rtl' : 'ltr';
  document.documentElement.lang = currentLang;

  // Update all elements with data-i18n
  document.querySelectorAll('[data-i18n]').forEach(el => {
    el.textContent = t(el.dataset.i18n);
  });

  // Update placeholders
  document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
    el.placeholder = t(el.dataset.i18nPlaceholder);
  });

  // Rebuild element grid with new translations
  buildElementGrid();
}

document.querySelectorAll('.lang-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    currentLang = btn.dataset.lang;
    updateAllTranslations();
  });
});

// Initialize
buildElementGrid();
  </script>
</body>
</html>
